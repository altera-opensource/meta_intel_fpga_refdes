#@TYPE: Machine
#@NAME: Intel SoCFPGA Agilex5
#@DESCRIPTION: Additional machine configuration for the Agilex5 SoCFPGA

IMAGE_TYPE:agilex5_dk_a5e013bb32aes ?= "gsrd"

UBOOT_CONFIG:agilex5_dk_a5e013bb32aes ?= "agilex5_dk_a5e013bb32aes-socdk-atf agilex5_dk_a5e013bb32aes-socdk-nand-atf"

KERNEL_DEVICETREE = " "

IMAGE_INSTALL:append:agilex5_dk_a5e013bb32aes = " \
		${@bb.utils.contains( 'IMAGE_BASENAME', "gsrd-console-image", " packagegroup-tsn-essential", "", d)} \
		"

MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS:append:agilex5_dk_a5e013bb32aes = " \
		kernel-modules \
		device-tree \
		hw-ref-design \
		"

EXTRA_IMAGEDEPENDS:append:agilex5_dk_a5e013bb32aes = " \
		u-boot-socfpga-scr \
		"

IMAGE_BOOT_FILES:agilex5_dk_a5e013bb32aes = " \
		boot.scr.uimg \
		u-boot.itb \
		kernel.itb \
		"

HYP_BUILD ?= "0"
XEN_EXTRA_PACKAGES = ""
XEN_EXTRA_PACKAGES:append = "${@'kernel-module-xen-blkback kernel-module-xen-gntalloc kernel-module-xen-gntdev kernel-module-xen-netback kernel-module-xen-wdt xen xen-tools xen-tools-xenstat ' if d.getVar('HYP_BUILD') == '1' else ''}"
IMAGE_INSTALL:append:agilex5_dk_a5e013bb32aes = "${@' socfpga-xen-passthrough' if d.getVar('HYP_BUILD') == '1' else ''}"
IMAGE_BOOT_FILES:append:agilex5_dk_a5e013bb32aes = "${@' xen Image devicetree/socfpga_agilex5_vanilla.dtb devicetree/socfpga_agilex5_socdk_emmc_vanilla.dtb boot.scr.xen.uimg boot.scr.xen.emmc.uimg agilex5_dk_a5e013bb32aes_gsrd_ghrd/ghrd.core.rbf agilex5_dk_a5e013bb32aes_gsrd_ghrd/emmc.core.rbf' if d.getVar('HYP_BUILD') == '1' else ''}"
